\section{Algebraic Curves}
Let $K$ be a perfect field, $\bar{K}$ a fixed algebraic closure of $K$, and $G_K := \gal(\bar{K}/K)$ the absolute Galois group.
I think there are two main additional features of algebraic curves compared to Riemann surfaces:\begin{itemize}
    \item the Galois group $G_K$ acts on a variety (and many objects relevant to it) over $K$, and
    \item there are inseparable extensions in the positive characteristics.
\end{itemize}

\subsection{Affine and Projective Vartieties over \texorpdfstring{$\bar{K}$}{bar K}}

Let $\bar{K}[\boldsymbol{X}] := \bar{K}[X_1, \dots, X_n]$ or $\bar{K}[X_0, X_1, \dots, X_n]$, $\A^n := \A^n(\bar K)$, and $\P^n:=\P^n(\bar{K})$.

\subsubsection{Vartieties and Local Rings}
An affine variety $V$ is defined as an irreducible algebraic set in $\A^n$; that is, $I(V)\subset \bar{K}[\boldsymbol{X}]$ is a prime ideal.
The affine coordinate ring and the function field of $V$ is \[\bar{K}[V] := \bar{K}[\boldsymbol{X}]/I(V) \myand \bar{K}(V) := \Frac \bar{K}[V].\]
For a point $P\in V$, we define the maximal ideal $\mathfrak{m}_P$ at $P$ to be the ideal of regular functions vanishing at $P$, i.e.,\[\mathfrak{m}_P := \{f\in \bar{K}[V] : f(P) = 0\};\]
and the local ring $\bar{K}[V]_P$ at $P$ to be the localisation of $\bar{K}[V]$ at $\mathfrak{m}_P$.
So we have a chain of function sets \[\mathfrak{m}_P \subset \bar{K}[V] \subset \bar{K}[V]_P \subset \bar{K}(V), \]
and elements in $\bar{K}[V]_P$ are called regular functions at $P$.

The dimension of $V$ is the transcendence degree of $\bar{K}(V)$ over $\bar{K}$. 
Let $P\in V$ and $I(V) = (f_1, \dots, f_m)$. The variety $V$ is said to be nonsingular or smooth at $P$, if the Jacobian matrix \[J_V(P) := \left( \pdfrac{f_i}{X_j}(P) \right)_{\substack{1\le i\le m \\ 1\le j\le n}}\] has rank $n - \dim V$, which is equivalent to \[\dim_{\bar{K}}\mathfrak{m}_P/\mathfrak{m}_P^2 = \dim V.\]
For examples, 
\begin{itemize}
    \item $\dim\A^n = n$, and
    \item $\dim V = n - 1 \iff I(V) = (f)$ for some $f\in \bar{K}[\boldsymbol{X}]$, and $V$ is singular iff \[\pdfrac{f}{X_1} = \dots = \pdfrac{f}{X_n} = 0.\]
\end{itemize}

Now we turn to projective varieties. A projective variety $V$ is a projective algebraic set $V\subset\P^n$ s.t. the homogeneous ideal \[I_+(V) = (f\in K[\boldsymbol{X}] : f\text{ is homogeneous and }f(V) = \{0\})\subset K[X_0, \dots, X_n]\] is prime. The field of rational functions is \[\bar{K}(V) := \left\{ \frac{f}{g} : f, g\in \bar{K}[\boldsymbol{X}]\big/I_+(V)\text{ are homogeneous of the same degree}, g\ne 0 \right\}\]

Let us fix an immersion $\A^n\inject \P^n$, say $\A^n = \{X_0\ne 0\}\subset\P^n$. We have two opposite processes.
\begin{itemize}
    \item For a projective $V\subset \P^n$, $V\cap \A^n$ is an affine variety with ideal \[I(V\cap \A^n) = \big(f(1, X_1, \dots, X_n) : f(X_0, X_1,\dots, X_n)\in I_+(V)\big)\] 
    \item For an affine $V\subset \A^n$, the projective closure $\bar{V}$ has ideal $I_+(\bar{V})$ generated by the homogenisation of $I(V)$ w.r.t. $X_0$.
\end{itemize}
\begin{proposition}
    Let $V\subset\P^n$ be a projective variety.\begin{enumerate}
        \item The affine variety $V\cap \A^n$ is either empty or has projective closure equal to $V$. In the latter case, $\bar{K}(V\cap \A^n)\simeq \bar{K}(V)$.
        \item For different choices of $\A^n\inject \P^n$ containing $P\in V$, the local rings $\bar{K}[V\cap \A^n]_P$ are canonically isomorphic as local rings.
    \end{enumerate}
\end{proposition}
Therefore, for $P\in V\subset\P^n$, we define $\mathfrak{m}_P$ and $\bar{K}[V]_P$ to be the corresponding local objects of $V\cap \A^n$, and the functions in $\bar{K}[V]_P$ are regular functions at $P$. 

\subsubsection{Rational Maps}
Let $V\subset\P^m$ and $W\subset \P^n$ be projective varieties.
A \textbf{rational map} $\phi : V\to W$ is a $(n+1)$-tuple \[\phi = [f_0 : \cdots : f_n],\]
where $f_i\in \bar{K}(V_1)$ are not all identically zero\footnote{Slightly informally, $f_i = F_i/G_i$ with $F_i, G_i\in\bar{K}[\boldsymbol{X}]$ homogeneous of the same degree, $G_i\notin I_+(V)$, and $\exists i$, $F_i\notin I_+(V)$.},
and \[\phi(P) := [f_0(P): \dots : f_n(P)]\in W\] when the left-hand-side makes sense.
We say $\phi$ is regular or defined at $P$ if $\phi(P)$ does make sense. So $\phi$ being regular is equivalent to that $\exists g\in \bar{K}(V)$ s.t. every $gf_i$ is regular at $P$ (i.e., $gf_i\in \bar{K}[V]_P$) and not all $gf_i$'s are zero.
An everywhere regular rational function is called a \textbf{morphism}\footnote{So a morphism is a rational map that is actually a map.}.
An \textbf{isomorphism} is a bijective morphism whose inverse is also a morphism.

% \begin{proposition}
%     A map $\phi : V \to W$ is a morphism, if and only if \begin{itemize}
%         \item $\phi$ is continuous\footnote{W.R.T. Zariski topology.}, and
%         \item 
%     \end{itemize}
% \end{proposition}


\subsection{Affine and Projective Vartieties over \texorpdfstring{$K$}{K}}
An affine/projective variety over $K$ is a variety $V$ defined by polynomials with coefficients in $K$; i.e., its ideal $I = I(V)$ or $I_+(V)$ is generated by \[I(V_{/K}) \text{ or } I_+(V_{/K}) := \{f\in I : f \in K[\boldsymbol{X}]\}.\]
The set of $K$-rational points are \[V(K) := V\cap \A^n(K) \text{ or } V\cap \P^n(K).\]
\begin{remark}
    $I(V_{/K})$ being prime does not implies that $I(V)$ is prime.
\end{remark}
Let $V_{/K}$ be an affine or projective variety.
Since for $P\in \A^n$ or $\P^n$ and $f\in \bar{K}[\boldsymbol{X}]$, \[P\in \A^n(K)\text{ or }\P^n(K) \iff P^\sigma = P\footnote{The Galois group acts on $\A^n$ or $\P^n$ coordinate-wisely.},\]
\[f\in K[\boldsymbol{X}]\iff f^\sigma = f,\]
and\[f(P)^\sigma = f^\sigma(P^\sigma)\]
for all $\sigma\in G_K$, we see that $G_K$ also acts on $V$, and \[V(K) = V^{G_K}.\]

The Galois group also acts on $\bar{K}[V]$ and $\bar{K}(V)$. We define the coordinate ring and function field over $K$ by \[K[V] := \bar{K}[V]^{G_K}\myand K(V) := \bar{K}(V)^{G_{/K}}.\]
It holds that\[K[V] = K[\boldsymbol{X}]/I(V_{/K}) \myand K(V) = \Frac K[V].\]

\begin{remark}
    What about $\mathfrak{m}_P\cap K[V]$ ?
\end{remark}

Consider $V_{1/K}$ and $V_{2/K}$.
The Galois group also acts on the rational functions $\phi : V_1\to V_2$ coordinate-wisely, and \[\phi(P)^\sigma = \phi^\sigma(P^\sigma),\ \forall\sigma\in G_K.\]
We say $\phi$ is defined over $K$ if $\phi$ is fixed by $G$.
This is equivalent to that there exists a constant $\lambda\in\bar{K}^\times$ sending every coordinate of $\phi$ in $\bar{K}(V_1)$ to $K(V_1)$.

\subsection{Products}
We begin by realising the set-theoretic product $\P^n\times\P^m$ as a projective variety. Define the \textbf{Segre embedding} \[S : \P^n\times\P^m \to \P^N,\ \left( [x_0 : \dots : x_n], [y_0 : \dots : y_m] \right)\mapsto [x_0y_0 : x_0y_1 : \dots : x_ny_m],\]where \[N = (n + 1)(m + 1) - 1 =  n + m + nm.\] This is a well-defined injection.

\begin{proposition}
    Denote the coordinates on $\P^n$, $\P^m$ and $\P^{N}$ by $X_i$'s, $Y_j$'s and $T_{ij}$'s, repectively.\begin{itemize}
    \item The image of $S$ is \[Z_+(\{T_{ij}T_{kl} - T_{il}T_{kj} : i, j = 0 , \dots, n; k, l = 0,\dots, m\}).\]
    \item The ideal generated by $T_{ij}T_{kl} - T_{il}T_{kj}$'s is irreducible, so $\P^n\times\P^m$ is bijective with a projective variety in $\P^N$.
\end{itemize}
\end{proposition}
\begin{proof}
    Let $I$ be the ideal generated by all $T_{ij}T_{kl} - T_{il}T_{kj}$'s.
    For the image, it suffices to show that on the affine charts, \[S(U_i\times U_j) = Z_+(I)\cap U_{ij}\footnote{$U_i = \{X_i\ne 0\}$, and so on.},\]which is obvious.

    The second statement follows by showing that $I$ is the kernel of the homomorphism
    \begin{equation}
        \psi : A[\boldsymbol{T}]\to A[\boldsymbol{X}, \boldsymbol{Y}],\ T_{ij}\mapsto X_iY_j
    \end{equation} for any ring $A$\footnote{See the first answer of \href{https://math.stackexchange.com/questions/353846/hartshorne-problem-1-2-14-on-segre-embedding}{this post.}}.
    But proving $\im S = Z_+(\ker\psi)$ to show irreducibility is easier. First, $I\subset\mathfrak{\ker\psi}$ and $Z_+(\ker\psi)\subset Z_+(I)$. For the other direction, if $t\in Z_+(I) = \im S$, any $f\in\ker\psi$ must kill $t = [x_0y_0:\dots:x_ny_m]$ by definition.

\end{proof}
So we use the Segre embedding to define algebraic sets and varieties in $\P^n\times\P^m$.
One sees that a subset $V \subset \P^n\times\P^m$ is algebraic, if and only if \[V = \{(x, y) : F_\alpha(x, y) = 0\}\]for some bi-homogeneous polynomials $F_\alpha(X, Y)\in \bar{K}[\boldsymbol{X},\boldsymbol{Y}]$.
In particular, the Zariski topology on $\P^n\times\P^m$ is finer than its product topology.

Let $V\subset \P^n$ and $W\subset \P^m$ be two varieties.
Their set-theoretic product $V\times W$ is an algebraic set, and, in fact, a variety.
% \begin{proposition}
%     The algebraic set $V\times W$ is irreducible.
% \end{proposition}
% \begin{proof}
%     Sorry.
% \end{proof}

\subsection{Connection with Schemes}

\subsection{Curves and Function Fields}
A \textbf{curve} over $K$ is a projective variety $C$ of dimension $1$ over $K$. Let $C_{/K}$ be a curve.

The first important property of curves is that their local rings $\bar{K}[C]_P$ at smooth points are DVR, because in this case the cotangent space $\mathfrak{m}_P/\mathfrak{m}_P^2$ have $\bar{K}$-dimension $1$.
So for a smooth point $P\in C$, we can define the order function $\ord_P$ to be the valuation \[\ord_P : \bar{K}[C]_P \to\Z_{\ge 0}\cup\{\infty\}.\]
In addition, there exist uniformisers in $K[C]$.

\begin{proposition}
    If $C$ is a smooth curve and $f$ is a nonzero rational function on $C$, then $f$ has only finitely many poles and zeros.
    Moreover, a rational function without poles must be constant.
\end{proposition}

Another important property is that rational maps from curves are regular at every smooth point. In particular, rational maps from smooth curves are all morphisms. This can be deduced using the DVR structures.
\begin{example}
    Let $C$ be a smooth curve, then there is a bijection between $K(C)\cup{\infty}$ with $\{C\to_{/K}\P^1\}$\footnote{The set of morphism defined over $K$.} in the obvious way.
\end{example}

Now we consider morphisms between curves. Let $C_1, C_2$ be curves over $K$, $\phi : C_1\to_{/K}C_2$ a nonconstant morphism.
\begin{theorem}
    Morphisms from a smooth curve to another curve are either constant or surjective.
\end{theorem}
So $\phi : C_1\surject C_2$ induces a field extension \[\phi^* : K(C_2)\inject K(C_1),\ f \mapsto \phi^*f = f\circ \phi.\]

\begin{theorem}
For a nonconstant morphism $\phi : C_1\surject C_2$, the extension $K(C_1)/K(C_2)$ given by $\phi^* : K(C_2)\inject K(C_1)$ is finite.

Conversely, if $\iota : K(C_2)\inject K(C_1)$ is a $K$-field extension, there is a unique $K$-morphism $\phi : K(C_1)\to K(C_2)$ s.t. $\phi^* = \iota$.
\end{theorem}


\begin{theorem}
    Let $C$ be a smooth curve over $K$. If $L$ is a subfield in $K(C)$ of finite index containing $K$, then there exists a unique curve $C'_{/K}$, up to $K$-isomorphism,together with a surjection $C\surject_{/K} C'$ inducing an isomorphism $K(C')\simeq L$.
\end{theorem}

\subsubsection*{Degrees and Ramification}
\begin{definition}
Let $\phi : C_1\to_{/K} C_2$ be nonconstant.
\begin{itemize}
    \item  We define the \textbf{degree} $\deg$, \textbf{seperable degree} $\deg_s$ and \textbf{inseparable degree} $\deg_i$ of $\phi$ to be the corresponding ``degrees'' of the field extension $K(C_1)/K(C_2)$ induced by $\phi$.
    \item Let $P\in C_1$ whose image is a smooth point. The \textbf{ramification index} of $\phi$ at $P$ is \[e_\phi(P) := \ord_P (\phi^*t_{\phi P})\ge 1,\]
    where $t_{\phi P}$ is any uniformiser at $\phi(P)$.
\end{itemize}
\end{definition}
One sees immediately that if $C_1\stackrel{\phi}{\to} C_2\stackrel{\psi}{\to}C_2$, then \[e_{\psi\circ\phi}(P) = e_{\psi}(\phi(P))e_{\phi}(P).\]

\begin{proposition}\label{sum rami index eq deg}
    Let $\phi : C_1\to C_2$ be a nonconstant morphism of smooth curves.\begin{enumerate}
        \item For all $Q\in C_2$,\[\sum_{P\in\phi^{-1}(Q)} e_\phi(P) = \deg\phi.\]
        \item For all but finitely many $Q\in C_2$,\[\#\phi^{-1}(Q) = \deg_s\phi.\]
    \end{enumerate}
\end{proposition}
As a corollary, $\phi$ is unramified iff $\#\phi^{-1}(Q) = \deg\phi$, $\forall Q\in C_2$. So if $\phi$ is seperable, then $\phi$ ramifies at finitely many points. 


\subsubsection*{Differentials}
Constructively, we define the space $\Omega_C$ of \textbf{meromorphic differential forms} on $C$ to be the $\bar{K}(C)$-vector space generated by symbols $dx$ for $x\in \bar{K}(C)$, subject to the conditions:\begin{itemize}
    \item $\dif(x + y) = \dif x + \dif y$, $\forall x, y\in \bar{K}(C)$;
    \item $\dif(xy) = y\dif x + x\dif y$, $\forall x, y\in\bar{K}(C)$;
    \item $\dif a = 0$, $\forall a\in\bar{K}$.
\end{itemize}

\begin{proposition}
    $\dim_{\bar{K}(C)} \Omega_C = 1$, and $dx$ is a $\bar{K}(C)$-basis iff $\bar{K}(C)/\bar{K}(x)$ is finite seperable.
\end{proposition}

Let $P\in C$ be a smooth point and $t$ a uniformiser at $P$.
Then by \cref{function field is seperable over uniformiser}, $dt$ is a $\bar{K}(C)$-basis of $\Omega_C$, and thus every $\omega\in\Omega_C$ can be written as $\omega = g\dif t$ with a unique function $g\in \bar{K}(C)$. We define $\omega/dt := g$.

\begin{proposition}\label{differential of regular is regular}
    If $f\in \bar{K}(C)$ is regular at a $P$, then $df/dt$ is regular at $P$ too.
\end{proposition}

\begin{propdef}
Let $\omega\in\Omega_C$. If $t$ is a uniformiser at $P\in C$, then $\ord_P (\omega/dt)$ is independent of the choice of the uniformiser $t$, and we define the \textbf{order of $\omega$ at $P$} $\ord_P(\omega) := \ord_P(\omega/dt)$.
\begin{enumerate}
    \item Let $P$ be a smooth point, $x, f\in\bar{K}(C)$ with $x(P) = 0$, $p = \cha K$, then \begin{align*}
        \ord_P(f\dif x) &= \ord_P(f) + \ord_P(x) - 1, &p\nmid \ord_P(x)\footnote{We adopt the convention that $0$ does not divide any integer.},\\
        \ord_P(f\dif x) &\ge \ord_P(f) + \ord_P(x), &p\mid \ord_P(x).
    \end{align*}
    \item If $\omega\ne 0$, then $\ord_P(\omega) = 0$ for almost all $P\in C$\footnote{This is not trivial, because a uniform uniformiser does not exist, so we cannot obtain $\omega = f\dif t$ with $\ord_P (dt) = 1, \forall P\in C$ from the previous formula directly.}.
\end{enumerate}
\end{propdef}
\begin{proof}
    Let $s$ be another uniformiser. By \cref{differential of regular is regular}, $ds/dt$ is regular, so \[\frac{\omega}{dt} = \frac{\omega}{ds}\frac{ds}{dt}\] shows that $\ord_P(\omega)$ is well-defined.
    \begin{enumerate}
        \item Direct calculation.
        \item Let $dx$ be a basis of $\Omega_C$ and $\omega = f\dif x$. By a corollary of \cref{sum rami index eq deg}, $x : C\to\P^1$ ramifies at finitely many points, so we may consider only those points $P$ at which $x$ is unramified. Also, we may assume $x(P)\ne \infty$, so \[1 = \ord_P(x - x(P)) = \ord_P(x^*(a\mapsto a - x(P))) = e_P(x).\qedhere\]
    \end{enumerate}
\end{proof}

\subsection{Divisors and Riemann-Roch Theorem}
The \textbf{divisor group} $\Div (C)$ of a curve $C$ is the free abelian group generated by points on $C$. We denote the divisor associates to a point $P\in C$ by $(P)$, so a divisor on $C$ is a formal sum \[D = \sum_{P\in C}n_P\cdot (P)\] with $n_P = 0$ for almost every $P$.
The deg of the above divisor is \[\deg D := \sum_P n_P,\]
giving a homomorphism $\deg : \Div(C) \to \Z$ whose kernel $\Div^0(C) := \ker\deg$ is the subgroup of degree zero divisors.

The divisor of a nonzero rational function $f$ is\[\div (f) := \sum_P\ord_P(f) (P),\]
giving a homomorphism $\div : \bar K(C)^\times\to\Div^0(C)\inject\Div(C)$ whose kernel is $\bar{K}^\times$ and its image is denoted by $\PDiv(C)$.
These divisors are called \textbf{principal} divisors.
We call two divisors $D_1, D_2$ to be \textbf{linearly equivalent}, written $D_1\sim D_2$, if $D_1-D_2$ is principal, and set \[\Pic(C) := \Div(C)/\PDiv(C)\myand \Pic^0(C) := \Div^0(C)/\PDiv^0(C).\]

The Galois group acts on all these groups, and their $G_K$-invariant part are called the group of those divisors over $K$.

Similarly, the divisor of a nonzero meromorphic differential form $\omega$ is \[\div(\omega) := \sum_P \ord_P(\omega)(P).\]
These divisors are called \textbf{canonical} divisors.
Note that all canonical divisors are linearly equivalent.

% A morphism $\phi : C_1\to C_2$ induces maps between divisor groups:\begin{align*}\phi^*:\text{Div}(C_2)&\longrightarrow\text{Div}(C_1),&\phi_*:\text{Div}(C_1)&\longrightarrow\text{Div}(C_2),\\(Q)&\longmapsto\sum_{P\in\phi^{-1}(Q)}e_\phi(P)(P),&(P)&\longmapsto(\phi P),\end{align*}with some calculation properties listed below.

% \begin{proposition}
%     Let $\phi : C_1\to C_2$ be nonconstant.
% \end{proposition}

For a divisor $D\in\Div(C)$, we say $D\ge 0$ if every coefficient of $D$ is nonnegtive.
So the space of functions with poles bounded by $D$ from below is\[L(D) := \{f\in \bar{K}(C) : \div(f) + D \ge 0\}.\]
This is $\bar{K}$-vector space, and we write $\ell(D) := \dim_{\bar{K}} L(D)$. If $D =  D' + \div (f)$, then $L(D)\simeq L(D')$ by $g\mapsto fg$.
\begin{theorem}
    The dimension $\ell(D)$ is finite, and \[\ell(D) - \ell(K_C - D) = \deg D + 1 - g,\]
    where $K_C$ is a canonical divisor and $g = \ell(K_C)$ is the \textbf{genus} of $C$.
\end{theorem}

\subsection{Some Examples}

\begin{example}
$E : y^2 = (x-e_1)(x-e_2)(x-e_3)$.\par
\begin{itemize}
    \item \textit{Points.} Look at the homogenisation \[Y^2Z = (X - e_1Z)(X-e_2Z)(X-e_3Z).\]
    It intersects $Z = 0$ only at $\infty := [0 : 1 : 0]$, so $\infty$ is the only point at infinity.
    For a chart at $\infty$, use \[s := \frac{X}{Y},\quad t := \frac{Z}{Y}\footnote{As I am not smart, I DON'T use $z$ and $x$ as notation here, otherwise I would fail to figure out what is $x - e_i$ at $\infty$ and would write things like ``$x = \frac{x}{z}$''. Replace $Z$ by $1$ is also fine, because this is what we do on the chart $Z = 0$.},\]
    and the equation is \[t = (s-e_1t)(s-e_2t)(s-e_3t).\]
    \item \textit{Singularity.} None.
    \item \textit{Local Rings.} $y = 1/t$ is a uniformiser at $e_i := [e_i : 0 : 1]$, $s = x/y$ is a uniformiser at $\infty$.
    For all other points $[a : b : 1]\ne e_i$, both $x-a$ and $y-b$ are uniformisers.
    \item \textit{Functions.} $\div(x-e_i) = 2\cdot e_i - 2\cdot \infty$, $\div(y) = e_1 + e_2 + e_3 - 3\cdot\infty$.
    \item \textit{Differential Forms.} Consider $dx$. Since $dx = d(x-e_i) = -x^2d(1/x)$ and $\ord_\infty x = \ord_\infty s/t = -2$, we have \[\div (dx) = e_1 + e_2 + e_3 - 3\cdot \infty,\] and thus \[\div\left( \frac{dx}{y} \right) = 0.\]
\end{itemize}
\end{example}

% \begin{example}
% $E : y^2 = x^3 - x$.
% \end{example}

\subsection{Curves over char \texorpdfstring{$p$}{p} and Frobenius}
In this subsection, assume that $\cha K = p > 0$.

\begin{proposition}\label{function field is seperable over uniformiser}
    Let $P\in C(K)$ be a $K$-rational smooth point and $t\in K[C]$ a uniformiser. Then the extension $K(C)/K(t)$ is finite and seperable.
\end{proposition}

\begin{proof}
    Both $K(C)$ and $K(t)$ has transcendence degree one over $K$, so $K(C)/K(t)$ is algebraic.
    
    Let $x\in K(C)$ and $\Phi(t, X)$ its minimal polynomial over $K(t)$.
\end{proof}
